---
title: "Final Landscape Project Report"
author: '3093819'
date: "12/11/2018"
output:
  pdf_document: default
  html_notebook: default
---


For this project, I created a Spatial Capture-Recapture (SCR) model (named "SCRA_Ind_Time.txt"; within the folders "Code/JAGS"). Sampling design for SCR models include obtaining encounter histories of individual organisms at a specific site. Traps are placed at equal increments apart in an array. The sampling occasion, trap ID, and turtle ID are recorded and the resulting data frame becomes the foundation for most objects created for a SCR model. The model outputs include an activity center per individual, density per site, and number of individuals estimated in site area. The activity centers are centroids of the space an individual used over a sampling session and is similar to a home range center. Activity centers per site represent a realization of a binomial point process (where total number of points in space is fixed).

During the Summer of 2018 I sampled for turtles at 12 sites for 4 days each (sampling occasion  = 4 days) by setting out 7 to 14 traps (hoop net traps) along the Chesapeake and Ohio Canal (from Cumberland to the Town Creek Aqueduct).

Objectives for this project included:
1) Develop a SCR model (in the program JAGS) that incorporates heterogeneity of capture probability by sampling day and individual. 
2) Obtain activity centers for 2 species (C. picta and C. serpentina; henceforth, CPIC and CSER) from the MCMC output for each model.
3) Analyze dispersion of activity centers for all sites and compare.
4) Analyze dispersion of activity centers for CPIC and CSER and compare.
5) Obtain densities of each species at each site and compare.

## Libraries
```{r, echo = FALSE, message = FALSE}
library(dplyr)
library(tidyr)
library(rjags)
library(parallel)
library(tibble)
library(spatstat)
library(spThin)
library(ggplot2)
library(plotrix)
library(reshape2)
```

I first downloaded my raw data from the summer.

## Load Main Data File for Spatial Capture Recapture Model (Raw data)
```{r}

EDF <- read.csv(file = "Data/EDF.csv", stringsAsFactors = FALSE)
head(EDF)

```

I created preliminary objects to use in my SCR model for each species and site combination. Preliminary objects included a trap location vector indicating distances from most upstream to most downstream trap, trap location matrices recording distance between all combinations of traps per site, and subset raw data for specific species and sites. In addition, trap locations and distances were scaled (divided by 0) to make model computation run smoothly.

## Subsetting Data and Creating Preliminary Objects Per Site and Species
```{r, eval = FALSE}

##Add a new column for integer session values (session = site)
EDF$site_num <- as.integer(as.factor(EDF$site))
summary(EDF)

# Create trap location vector
traplocsA <- c(0,25,50,75,100,125,150,175) # create trap location file
traplocsC <- c(0,25,50,75,100,125,150,175,200,225)
traplocsD <- c(0,25,50,75,100,125,150,175)
traplocsE <- c(0,25,50,75,100,125,150,175,200,225,250,275,300,325)
traplocsF <- c(0,25,50,75,100,125,150)
traplocsG <- c(0,25,50,75,100,125,150)
traplocsJ <- c(0,25,50,75,100,125,150,175,200,225)
traplocsK <- c(0,25,50,75,100,125,150,175,200,225)
traplocsL <- c(0,25,50,75,100,125,150,175)
traplocsM <- c(0,25,50,75,100,125,150,175,200,225,250,275)
traplocsN <- c(0,25,50,75,100,125,150,175,200,225)
traplocsO <- c(0,25,50,75,100,125,150,175,200,225)
#thess are in a vertical format

# Create a Trap Location Matrix (integers = distance apart in m); 1 Matrix per Site
#### MatrixA
matrixA <- matrix(NA, ncol = length(traplocsA), nrow = length(traplocsA))

matrixA[ ,1] <- c(0,25,50,75,100,125,150,175)
matrixA[ ,2] <- c(25,0,25,50,75,100,125,150)
matrixA[ ,3] <- c(50,25,0,25,50,75,100,125)
matrixA[ ,4] <- c(75, 50,25,0,25,50,75,100)
matrixA[ ,5] <- c(100,75, 50,25,0,25,50,75)
matrixA[ ,6] <- c(125,100,75, 50,25,0,25,50)
matrixA[ ,7] <- c(150,125,100,75, 50,25,0,25)
matrixA[ ,8] <- c(175,150,125,100,75, 50,25,0)
matrixA  # will need to use coordinates if use all sites in 1 model! or figure out distance b/w sites

#### Matrix C
matrixC <- matrix(NA, ncol = length(traplocsC), nrow = length(traplocsC))
matrixC[ ,1] <- c(0,25,50,75,100,125,150,175,200,225)
matrixC[ ,2] <- c(25,0,25,50,75,100,125,150,175,200)
matrixC[ ,3] <- c(50,25,0,25,50,75,100,125,150,175)
matrixC[ ,4] <- c(75, 50,25,0,25,50,75,100,125,150)
matrixC[ ,5] <- c(100,75,50,25,0,25,50,75,100,125)
matrixC[ ,6] <- c(125,100,75,50,25,0,25,50,75,100)
matrixC[ ,7] <- c(150,125,100,75,50,25,0,25,50,75)
matrixC[ ,8] <- c(175,150,125,100,75,50,25,0,25,50)
matrixC[ , 9] <- c(200,175,150,125,100,75,50,25,0,25)
matrixC[ , 10] <- c(225,200,175,150,125,100,75,50,25,0)

#### Matrix D
matrixD <- matrixA

#### Matrix E
matrixE <- matrix(NA, ncol = length(traplocsE), nrow = length(traplocsE))
matrixE[ ,1] <- c(0,25,50,75,100,125,150,175,200,225,250,275,300,325)
matrixE[ ,2] <- c(25,0,25,50,75,100,125,150,175,200,225,250,275,300)
matrixE[ ,3] <- c(50,25,0,25,50,75,100,125,150,175,200,225,250,275)
matrixE[ ,4] <- c(75, 50,25,0,25,50,75,100,125,150,175,200,225,250)
matrixE[ ,5] <- c(100,75,50,25,0,25,50,75,100,125,150,175,200,225)
matrixE[ ,6] <- c(125,100,75,50,25,0,25,50,75,100,125,150,175,200)
matrixE[ ,7] <- c(150,125,100,75,50,25,0,25,50,75,100,125,150,175)
matrixE[ ,8] <- c(175,150,125,100,75,50,25,0,25,50,75,100,125,150)
matrixE[ , 9] <- c(200,175,150,125,100,75,50,25,0,25,50,75,100,125)
matrixE[ , 10] <- c(225,200,175,150,125,100,75,50,25,0,25,50,75,100)
matrixE[ , 11] <- c(250,225,200,175,150,125,100,75,50,25,0,25,50,75)
matrixE[ , 12] <- c(275,250,225,200,175,150,125,100,75,50,25,0,25,50)
matrixE[ , 13] <- c(300,275,250,225,200,175,150,125,100,75,50,25,0,25)
matrixE[ , 14] <- c(325,300,275,250,225,200,175,150,125,100,75,50,25,0)


#### Matrix F
matrixF <- matrix(NA, ncol = length(traplocsF), nrow = length(traplocsF))
matrixF[ ,1] <- c(0,25,50,75,100,125,150)
matrixF[ ,2] <- c(25,0,25,50,75,100,125)
matrixF[ ,3] <- c(50,25,0,25,50,75,100)
matrixF[ ,4] <- c(75, 50,25,0,25,50,75)
matrixF[ ,5] <- c(100,75, 50,25,0,25,50)
matrixF[ ,6] <- c(125,100,75, 50,25,0,25)
matrixF[ ,7] <- c(150,125,100,75, 50,25,0)

#### Matrix G
matrixG <- matrixF

#### Matrix J
matrixJ <- matrixC

#### Matrix K
matrixK <- matrixC

#### Matrix L
matrixL <- matrixA

#### Matrix M
matrixM <- matrix(NA, ncol = length(traplocsM), nrow = length(traplocsM))

matrixM[ ,1] <- c(0,25,50,75,100,125,150,175,200,225,250,275)
matrixM[ ,2] <- c(25,0,25,50,75,100,125,150,175,200,225,250)
matrixM[ ,3] <- c(50,25,0,25,50,75,100,125,150,175,200,225)
matrixM[ ,4] <- c(75, 50,25,0,25,50,75,100,125,150,175,200)
matrixM[ ,5] <- c(100,75,50,25,0,25,50,75,100,125,150,175)
matrixM[ ,6] <- c(125,100,75,50,25,0,25,50,75,100,125,150)
matrixM[ ,7] <- c(150,125,100,75,50,25,0,25,50,75,100,125)
matrixM[ ,8] <- c(175,150,125,100,75,50,25,0,25,50,75,100)
matrixM[ , 9] <- c(200,175,150,125,100,75,50,25,0,25,50,75)
matrixM[ , 10] <- c(225,200,175,150,125,100,75,50,25,0,25,50)
matrixM[ , 11] <- c(250,225,200,175,150,125,100,75,50,25,0,25)
matrixM[ , 12] <- c(275,250,225,200,175,150,125,100,75,50,25,0)

#### Matrix N
matrixN <- matrixC

#### Matrix O
matrixO <- matrixC

# Trap location and distance matrices / 100
# scale for computational purposes
traplocsA <- traplocsA / 100
traplocsC <- traplocsC / 100
traplocsD <- traplocsD / 100
traplocsE <- traplocsE / 100
traplocsF <- traplocsF / 100
traplocsG <- traplocsG / 100
traplocsJ <- traplocsJ / 100
traplocsK <- traplocsK / 100
traplocsL <- traplocsL / 100
traplocsM <- traplocsM / 100
traplocsN <- traplocsN / 100
traplocsO <- traplocsO / 100
matrixA <- matrixA / 100
matrixC <- matrixC / 100
matrixD <- matrixD / 100
matrixE <- matrixE / 100
matrixF <- matrixF / 100
matrixG <- matrixG / 100
matrixJ <- matrixJ / 100
matrixK <- matrixK / 100
matrixL <- matrixL / 100
matrixM <- matrixM / 100
matrixN <- matrixN / 100
matrixO <- matrixO / 100

## Subset Data for Sites and Species (Density of all turtles per site)

# Site A, CPIC
EDFA <- EDF %>%
  filter(site_num == 1 & species == "CPIC")
EDFA

# Site A, CSER
EDFA_CSER <- EDF %>%
  filter(site_num == 1 & species == "CSER")
EDFA_CSER[5,4] <- 555  #### Filling in blank ID

# Site C, CPIC
EDFC <- EDF %>%
  filter(site_num == 2 & species == "CPIC")
EDFC

# Site C, CSER
EDFC_CSER <- EDF %>%
  filter(site_num == 2 & species == "CSER")
EDFC_CSER

# Site D, CPIC
EDFD <- EDF %>%
  filter(site_num == 3 & species == "CPIC")
EDFD

# Site D, CSER
EDFD_CSER <- EDF %>%
  filter(site_num == 3 & species == "CSER")
EDFD_CSER  ###### 2 individuals

# Site E, CPIC
EDFE <- EDF %>%
  filter(site_num == 4 & species == "CPIC")
EDFE

# Site E, CSER
EDFE_CSER <- EDF %>%
  filter(site_num == 4 & species == "CSER")
EDFE_CSER

# Site F, CPIC
EDFF <- EDF %>%
  filter(site_num == 5 & species == "CPIC")
EDFF

# Site F, CSER
EDFF_CSER <- EDF %>%
  filter(site_num == 5 & species == "CSER")
EDFF_CSER

# Site G, CPIC
EDFG <- EDF %>%
  filter(site_num == 6 & species == "CPIC")
EDFG

# Site G, CSER
EDFG_CSER <- EDF %>%
  filter(site_num == 6 & species == "CSER")
EDFG_CSER

# Site J, CPIC
EDFJ <- EDF %>%
  filter(site_num == 9 & species == "CPIC")
EDFJ

# Site J, CSER
EDFJ_CSER <- EDF %>%
  filter(site_num == 9 & species == "CSER")
EDFJ_CSER

# Site K, CPIC
EDFK <- EDF %>%
  filter(site_num == 10 & species == "CPIC")
EDFK

# Site K, CSER
EDFK_CSER <- EDF %>%
  filter(site_num == 10 & species == "CSER")
EDFK_CSER   #### Only 2 individuals

# Site L, CPIC
EDFL <- EDF %>%
  filter(site_num == 11 & species == "CPIC")
EDFL

# Site L, CSER
EDFL_CSER <- EDF %>%
  filter(site_num == 11 & species == "CSER")
EDFL_CSER  #### Only 1 individual

# Site M, CPIC
EDFM <- EDF %>%
  filter(site_num == 12 & species == "CPIC")
EDFM

# Site M, CSER
EDFM_CSER <- EDF %>%
  filter(site_num == 12 & species == "CSER")
EDFM_CSER

# Site N, CPIC
EDFN <- EDF %>%
  filter(site_num == 13 & species == "CPIC")
EDFN

# Site N, CSER
EDFN_CSER <- EDF %>%
  filter(site_num == 13 & species == "CSER")
EDFN_CSER

# Site O, CPIC
EDFO <- EDF %>%
  filter(site_num == 14 & species == "CPIC")
EDFO

# Site O, CSER
EDFO_CSER <- EDF %>%
  filter(site_num == 14 & species == "CSER")
EDFO_CSER


```


#Model Information:
I first created a null model (without heterogeneity in capture probability by day or individual) and evolved the model until it is what is shown below.

alpha0 = set prob. of baseline encounter
logit = constraining prob between 0 and 1
alpha1 = set probability of encounter at 1 unit distance away from alpha0
sigma = scale parameter of a half-normal
For each individual for number of augments (M), find z[i] - likelihood that augment is part of sampled population, activity center (acs assumed to be uniformally distributed) , and for each trap.
Calculate distance of each individual i from trap j using distance equation.
Estimate parameters affecting the observed number of times caught per trap reflecting a      binomial distribution with probability of encounter changing by individual and day.
Estimate encounter probability parameters including likelihood an individual is part of population.

# Calculate population size by summing all 1s associated with individuals within the population that were sampled (prob. of z = 1)
# Calculate density by dividing population size by state space size (trapping length + buffers).

#### THE MODEL

```{r, eval = FALSE}

#### Model with individual heterogeneity in capture probability ####
cat ("
  model {
     # alpha1 ~ dgamma(0.1, 0.1) # consider appropriate prior
     # alpha1 ~ dt(0, 1 / (5^2), 1)I(0, ) 	## implies half-cauchy with scale of 5
     alpha1 ~ dnorm(0, 1 / (25^2))I(0, ) 	## half normal
     sigma <- pow(1 / (2*alpha1), 0.5) # sd of half normal
     psi ~ dunif(0, 1)

sigma_ind ~ dt(0, 1 / (25^2), 1)I(0, ) 	## implies half-cauchy with scale of 25
for(i in 1:M) {
for(k in 1:K) {
eta[i,k] ~ dnorm(0, 1 / (sigma_ind * sigma_ind))
}
}

     for(k in 1:K) {
     alpha0[k] ~ dnorm(0, 0.1)
     }
     for(i in 1:M) {
     z[i] ~ dbern(psi)
     s[i] ~ dunif(xlimA[1], xlimA[2])
     for(j in 1:n_traps) {
     d[i,j] <- abs(s[i] - traplocsA[j])
     for(k in 1:K) {
logit(p0[i,j,k]) <- alpha0[k] + eta[i,k]
     y[i,j, k] ~ dbern(p[i,j,k])
     p[i,j, k] <- z[i]*p0[i,j,k]*exp(- alpha1 * d[i,j] * d[i,j])
     }
     }
     }
     # Derived parameters
     N <- sum(z[ ])
     density <- N / (xlimA[2] - xlimA[1]) # divided distances by 100 so calculates turtles per 100 m of canal
     }
     ", file = "Code/JAGS/SCR_Ind_Time.txt")


testing <- TRUE
if(testing) {
  na = 500
  ni = 500
  nt = 1
  nc = 3
} else {
  na = 100000
  ni = 600000
  nt = 60
  nc = 4
}

```


## Creating Objects Specific to SCR Model
Objects Created Per Site and Species Found in "Site_Species_Models.R"

# Example: Running model on one set of objects for CPIC Site A

```{r, eval = FALSE}
jags_data <- list(y = EM_arrayA, traplocsA = traplocsA, K=K, M=M_A, xlimA=xlimA, n_traps = n_trapsA)
inits <- function() {
  list(alpha0=rnorm(4,-2,.4), alpha1=runif(1,1,2), s=as.numeric(sstA[]), z=z_A, psi = runif(1))
}

parameters <- c("alpha0", "alpha1", "sigma", "N", "density", "s", "sigma_ind", "psi", "z")

# run in parallel explicitly
cl <- makeCluster(nc)                       # Request # cores
clusterExport(cl, c("jags_data", "inits", "parameters", "z_A", "sstA", "ni", "na", "nt")) # Make these available
clusterSetRNGStream(cl = cl, 54354354)

system.time({ # no status bar (% complete) when run in parallel
  out_1_cpic <- clusterEvalQ(cl, {
    library(rjags)
    jm <- jags.model("Code/JAGS/SCR_Ind_Time.txt", jags_data, inits, n.adapt = na, n.chains = 1) # Compile model and run burnin
    out_1_cpic <- coda.samples(jm, parameters, n.iter = ni, thin = nt) # Sample from posterior distribution
    return(as.mcmc(out_1_cpic))
  })
}) #

stopCluster(cl)

cpic_A_mcmc <- mcmc.list(out_1_cpic)

save(cpic_A_mcmc, file = "Results/JAGS/cpic_A_mcmc.RData")

Run Model On Objects for each Site - Species Combination.
parameters, initial values, iterations - adapt, iterations - saved each mcmc file under folder "Results/JAGS" "JAGS"
```

#SEE REST OF CODE IN "Site_Species_Model.R" (Too large for Markdown to knit)


## Obtaining List of Activity Centers and Density Per Site and Species
As MCMC chains were run in parallel processing, I first combined rows of the resulting 3 list objects into one result object. I then obtained activity centers per individual and densities per site from each complete MCMC object after averaging the results from all chains.

```{r, eval = FALSE}

####### Site A, CPIC ########
# Load MCMC Data
load("Results/JAGS/cpic_A_mcmc.RData")

# combine chains
df_mcmc_cpic_A <- as.data.frame(cpic_A_mcmc[[1]])
for(i in 2:length(cpic_A_mcmc)) {
  df_mcmc_cpic_A <- bind_rows(df_mcmc_cpic_A, as.data.frame(cpic_A_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_A <- df_mcmc_cpic_A %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_A <- centers_cpic_A[1:36, ]

hist(centers_cpic_A[]) # activity centers for individuals caught at least once


#### Obtaining Density and N For Site A and CPICS from MCMC Output ####

densities_cpic_A <- df_mcmc_cpic_A$density[501:1000] #densities per iteration after burnin
stderror_cpic_A <- std.error(as.vector(densities_cpic_A))
mean_density_cpic_A <- mean(densities_cpic_A) # Mean # turtles per 100 meters

estimated_N_cpic_A <- df_mcmc_cpic_A$N[501:1000]
mean_est_N_cpic_A <- mean(estimated_N_cpic_A) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_A/mean_density_cpic_A

###################################################

############ Site A, CSER ##############
load("Results/JAGS/cser_A_mcmc.RData")

# combine chains
df_mcmc_cser_A <- as.data.frame(cser_A_mcmc[[1]])
for(i in 2:length(cser_A_mcmc)) {
  df_mcmc_cser_A <- bind_rows(df_mcmc_cser_A, as.data.frame(cser_A_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_A <- df_mcmc_cser_A %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_A <- centers_cser_A[1:n_indA, ]

hist(centers_cser_A) # activity centers for individuals caught at least once


#### Obtaining Density and N For Site A and CSER from MCMC Output ####

densities_cser_A <- df_mcmc_cser_A$density[501:1000] #densities per iteration after burnin
stderror_cser_A <- std.error(as.vector(densities_cser_A))
mean_density_cser_A <- mean(densities_cser_A) # Mean # turtles per 100 meters

estimated_N_cser_A <- df_mcmc_cser_A$N[501:1000]
mean_est_N_cser_A <- mean(estimated_N_cser_A) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_A/mean_density_cser_A


####### Site C, CPIC ########

# Load MCMC Data
load("Results/JAGS/cpic_C_mcmc.RData")

# combine chains
df_mcmc_cpic_C <- as.data.frame(cpic_C_mcmc[[1]])
for(i in 2:length(cpic_C_mcmc)) {
  df_mcmc_cpic_C <- bind_rows(df_mcmc_cpic_C, as.data.frame(cpic_C_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_C <- df_mcmc_cpic_C %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_C <- centers_cpic_C[1:n_indC, ]

hist(centers_cpic_C) # activity centers for individuals caught at least once
# hist(centers)

#### Obtaining Density and N

densities_cpic_C <- df_mcmc_cpic_C$density[501:1000] #densities per iteration after burnin
stderror_cpic_C <- std.error(as.vector(densities_cpic_C))
mean_density_cpic_C <- mean(densities_cpic_C) # Mean # turtles per 100 meters

estimated_N_cpic_C <- df_mcmc_cpic_C$N[501:1000]
mean_est_N_cpic_C <- mean(estimated_N_cpic_C) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_C/mean_density_cpic_C

####### Site C, CSER ########

# Load MCMC Data
load("Results/JAGS/cser_C_mcmc.RData")

# combine chains
df_mcmc_cser_C <- as.data.frame(cser_C_mcmc[[1]])
for(i in 2:length(cser_C_mcmc)) {
  df_mcmc_cser_C <- bind_rows(df_mcmc_cser_C, as.data.frame(cser_C_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_C <- df_mcmc_cser_C %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_C <- centers_cser_C[1:n_indC, ]

hist(centers_cser_C) # activity centers for individuals caught at least once
# hist(centers)

#### Obtaining Density For Site 1 and CPICS from MCMC Output ####

densities_cser_C <- df_mcmc_cser_C$density[501:1000] #densities per iteration after burnin
stderror_cser_C <- std.error(as.vector(densities_cser_C))
mean_density_cser_C <- mean(densities_cser_C) # Mean # turtles per 100 meters

estimated_N_cser_C <- df_mcmc_cser_C$N[501:1000]
mean_est_N_cser_C <- mean(estimated_N_cser_C) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_C/mean_density_cser_C


####### Site D, CPIC ########

load("Results/JAGS/cpic_D_mcmc.RData")

# combine chains
df_mcmc_cpic_D <- as.data.frame(cpic_D_mcmc[[1]])
for(i in 2:length(cpic_D_mcmc)) {
  df_mcmc_cpic_D <- bind_rows(df_mcmc_cpic_D, as.data.frame(cpic_D_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_D <- df_mcmc_cpic_D %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_D <- centers_cpic_D[1:n_indD, ]

hist(centers_cpic_D) # activity centers for individuals caught at least once
# hist(centers)

#### Obtaining Density For Site 1 and CPICS from MCMC Output ####

densities_cpic_D <- df_mcmc_cpic_D$density[501:1000] #densities per iteration after burnin
stderror_cpic_D <- std.error(as.vector(densities_cpic_D))
mean_density_cpic_D <- mean(densities_cpic_D) # Mean # turtles per 100 meters

estimated_N_cpic_D <- df_mcmc_cpic_D$N[501:1000]
mean_est_N_cpic_D <- mean(estimated_N_cpic_D) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_D/mean_density_cpic_D

####### Site E, CPIC ########

load("Results/JAGS/cpic_E_mcmc.RData")

# combine chains
df_mcmc_cpic_E <- as.data.frame(cpic_E_mcmc[[1]])
for(i in 2:length(cpic_E_mcmc)) {
  df_mcmc_cpic_E <- bind_rows(df_mcmc_cpic_E, as.data.frame(cpic_E_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_E <- df_mcmc_cpic_E %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_E <- centers_cpic_E[1:n_indE, ]

hist(centers_cpic_E) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_E <- df_mcmc_cpic_E$density[501:1000] #densities per iteration after burnin
stderror_cpic_E <- std.error(as.vector(densities_cpic_E))
mean_density_cpic_E <- mean(densities_cpic_E) # Mean # turtles per 100 meters

estimated_N_cpic_E <- df_mcmc_cpic_E$N[501:1000]
mean_est_N_cpic_E <- mean(estimated_N_cpic_E) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_E/mean_density_cpic_E


####### Site E, CSER ########

load("Results/JAGS/cser_E_mcmc.RData")

# combine chains
df_mcmc_cser_E <- as.data.frame(cser_E_mcmc[[1]])
for(i in 2:length(cser_E_mcmc)) {
  df_mcmc_cser_E <- bind_rows(df_mcmc_cser_E, as.data.frame(cser_E_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_E <- df_mcmc_cser_E %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_E <- centers_cser_E[1:n_indE, ]

hist(centers_cser_E) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cser_E <- df_mcmc_cser_E$density[501:1000] #densities per iteration after burnin
stderror_cser_E <- std.error(as.vector(densities_cser_E))
mean_density_cser_E <- mean(densities_cser_E) # Mean # turtles per 100 meters

estimated_N_cser_E <- df_mcmc_cser_E$N[501:1000]
mean_est_N_cser_E <- mean(estimated_N_cser_E) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_E/mean_density_cser_E


####### Site F, CSER ########

load("Results/JAGS/cser_F_mcmc.RData")

# combine chains
df_mcmc_cser_F <- as.data.frame(cser_F_mcmc[[1]])
for(i in 2:length(cser_F_mcmc)) {
  df_mcmc_cser_F <- bind_rows(df_mcmc_cser_F, as.data.frame(cser_F_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_F <- df_mcmc_cser_F %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_F <- centers_cser_F[1:n_indF, ]

hist(centers_cser_F) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cser_F <- df_mcmc_cser_F$density[501:1000] #densities per iteration after burnin
stderror_cser_F <- std.error(as.vector(densities_cser_F))
mean_density_cser_F <- mean(densities_cser_F) # Mean # turtles per 100 meters

estimated_N_cser_F <- df_mcmc_cser_F$N[501:1000]
mean_est_N_cser_F <- mean(estimated_N_cser_F) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_F/mean_density_cser_F


####### Site F, CPIC ########

load("Results/JAGS/cpic_F_mcmc.RData")

# combine chains
df_mcmc_cpic_F <- as.data.frame(cpic_F_mcmc[[1]])
for(i in 2:length(cpic_F_mcmc)) {
  df_mcmc_cpic_F <- bind_rows(df_mcmc_cpic_F, as.data.frame(cpic_F_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_F <- df_mcmc_cpic_F %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_F <- centers_cpic_F[1:n_indF, ]

hist(centers_cpic_F) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_F <- df_mcmc_cpic_F$density[501:1000] #densities per iteration after burnin
stderror_cpic_F <- std.error(as.vector(densities_cpic_F))
mean_density_cpic_F <- mean(densities_cpic_F) # Mean # turtles per 100 meters

estimated_N_cpic_F <- df_mcmc_cpic_F$N[501:1000]
mean_est_N_cpic_F <- mean(estimated_N_cpic_F) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_F/mean_density_cpic_F


####### Site G, CPIC ########

load("Results/JAGS/cpic_G_mcmc.RData")

# combine chains
df_mcmc_cpic_G <- as.data.frame(cpic_G_mcmc[[1]])
for(i in 2:length(cpic_G_mcmc)) {
  df_mcmc_cpic_G <- bind_rows(df_mcmc_cpic_G, as.data.frame(cpic_G_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_G <- df_mcmc_cpic_G %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_G <- centers_cpic_G[1:n_indG, ]

hist(centers_cpic_G) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_G <- df_mcmc_cpic_G$density[501:1000] #densities per iteration after burnin
stderror_cpic_G <- std.error(as.vector(densities_cpic_G))
mean_density_cpic_G <- mean(densities_cpic_G) # Mean # turtles per 100 meters

estimated_N_cpic_G <- df_mcmc_cpic_G$N[501:1000]
mean_est_N_cpic_G <- mean(estimated_N_cpic_G) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_G/mean_density_cpic_G


####### Site G, CSER ########

load("Results/JAGS/cser_G_mcmc.RData")

# combine chains
df_mcmc_cser_G <- as.data.frame(cser_G_mcmc[[1]])
for(i in 2:length(cser_G_mcmc)) {
  df_mcmc_cser_G <- bind_rows(df_mcmc_cser_G, as.data.frame(cser_G_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_G <- df_mcmc_cser_G %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_G <- centers_cser_G[1:n_indG, ]

hist(centers_cser_G) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cser_G <- df_mcmc_cser_G$density[501:1000] #densities per iteration after burnin
stderror_cser_G <- std.error(as.vector(densities_cser_G))
mean_density_cser_G <- mean(densities_cser_G) # Mean # turtles per 100 meters

estimated_N_cser_G <- df_mcmc_cser_G$N[501:1000]
mean_est_N_cser_G <- mean(estimated_N_cser_G) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_G/mean_density_cser_G


####### Site J, CPIC ########

load("Results/JAGS/cpic_J_mcmc.RData")

# combine chains
df_mcmc_cpic_J <- as.data.frame(cpic_J_mcmc[[1]])
for(i in 2:length(cpic_J_mcmc)) {
  df_mcmc_cpic_J <- bind_rows(df_mcmc_cpic_J, as.data.frame(cpic_J_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_J <- df_mcmc_cpic_J %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_J <- centers_cpic_J[1:n_indJ, ]

hist(centers_cpic_J) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_J <- df_mcmc_cpic_J$density[501:1000] #densities per iteration after burnin
stderror_cpic_J <- std.error(as.vector(densities_cpic_J))
mean_density_cpic_J <- mean(densities_cpic_J) # Mean # turtles per 100 meters

estimated_N_cpic_J <- df_mcmc_cpic_J$N[501:1000]
mean_est_N_cpic_J <- mean(estimated_N_cpic_J) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_J/mean_density_cpic_J


####### Site J, CSER ########

load("Results/JAGS/cser_J_mcmc.RData")

# combine chains
df_mcmc_cser_J <- as.data.frame(cser_J_mcmc[[1]])
for(i in 2:length(cser_J_mcmc)) {
  df_mcmc_cser_J <- bind_rows(df_mcmc_cser_J, as.data.frame(cser_J_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_J <- df_mcmc_cser_J %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_J <- centers_cser_J[1:n_indJ, ]

hist(centers_cser_J) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cser_J <- df_mcmc_cser_J$density[501:1000] #densities per iteration after burnin
stderror_cser_J <- std.error(as.vector(densities_cser_J))
mean_density_cser_J <- mean(densities_cser_J) # Mean # turtles per 100 meters

estimated_N_cser_J <- df_mcmc_cser_J$N[501:1000]
mean_est_N_cser_J <- mean(estimated_N_cser_J) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_J/mean_density_cser_J


####### Site K, CPIC ########

load("Results/JAGS/cpic_K_mcmc.RData")

# combine chains
df_mcmc_cpic_K <- as.data.frame(cpic_K_mcmc[[1]])
for(i in 2:length(cpic_K_mcmc)) {
  df_mcmc_cpic_K <- bind_rows(df_mcmc_cpic_K, as.data.frame(cpic_K_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_K <- df_mcmc_cpic_K %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_K <- centers_cpic_K[1:n_indK, ]

hist(centers_cpic_K) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_K <- df_mcmc_cpic_K$density[501:1000] #densities per iteration after burnin
stderror_cpic_K <- std.error(as.vector(densities_cpic_K))
mean_density_cpic_K <- mean(densities_cpic_K) # Mean # turtles per 100 meters

estimated_N_cpic_K <- df_mcmc_cpic_K$N[501:1000]
mean_est_N_cpic_K <- mean(estimated_N_cpic_K) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_K/mean_density_cpic_K


####### Site L, CPIC ########

load("Results/JAGS/cpic_L_mcmc.RData")

# combine chains
df_mcmc_cpic_L <- as.data.frame(cpic_L_mcmc[[1]])
for(i in 2:length(cpic_L_mcmc)) {
  df_mcmc_cpic_L <- bind_rows(df_mcmc_cpic_L, as.data.frame(cpic_L_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_L <- df_mcmc_cpic_L %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_L <- centers_cpic_L[1:n_indL, ]

hist(centers_cpic_L) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_L <- df_mcmc_cpic_L$density[501:1000] #densities per iteration after burnin
stderror_cpic_L <- std.error(as.vector(densities_cpic_L))
mean_density_cpic_L <- mean(densities_cpic_L) # Mean # turtles per 100 meters

estimated_N_cpic_L <- df_mcmc_cpic_L$N[501:1000]
mean_est_N_cpic_L <- mean(estimated_N_cpic_L) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_L/mean_density_cpic_L


####### Site M, CPIC ########

load("Results/JAGS/cpic_M_mcmc.RData")

# combine chains
df_mcmc_cpic_M <- as.data.frame(cpic_M_mcmc[[1]])
for(i in 2:length(cpic_M_mcmc)) {
  df_mcmc_cpic_M <- bind_rows(df_mcmc_cpic_M, as.data.frame(cpic_M_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_M <- df_mcmc_cpic_M %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_M <- centers_cpic_M[1:n_indM, ]

hist(centers_cpic_M) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cpic_M <- df_mcmc_cpic_M$density[501:1000] #densities per iteration after burnin
stderror_cpic_M <- std.error(as.vector(densities_cpic_M))
mean_density_cpic_M <- mean(densities_cpic_M) # Mean # turtles per 100 meters

estimated_N_cpic_M <- df_mcmc_cpic_M$N[501:1000]
mean_est_N_cpic_M <- mean(estimated_N_cpic_M) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_M/mean_density_cpic_M


####### Site M, CSER ########

load("Results/JAGS/cser_M_mcmc.RData")

# combine chains
df_mcmc_cser_M <- as.data.frame(cser_M_mcmc[[1]])
for(i in 2:length(cser_M_mcmc)) {
  df_mcmc_cser_M <- bind_rows(df_mcmc_cser_M, as.data.frame(cser_M_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_M <- df_mcmc_cser_M %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_M <- centers_cser_M[1:n_indM, ]

hist(centers_cser_M) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cser_M <- df_mcmc_cser_M$density[501:1000] #densities per iteration after burnin
stderror_cser_M <- std.error(as.vector(densities_cser_M))
mean_density_cser_M <- mean(densities_cser_M) # Mean # turtles per 100 meters

estimated_N_cser_M <- df_mcmc_cser_M$N[501:1000]
mean_est_N_cser_M <- mean(estimated_N_cser_M) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_M/mean_density_cser_M


####### Site N, CPIC ########

load("Results/JAGS/cpic_N_mcmc.RData")

# combine chains
df_mcmc_cpic_N <- as.data.frame(cpic_N_mcmc[[1]])
for(i in 2:length(cpic_N_mcmc)) {
  df_mcmc_cpic_N <- bind_rows(df_mcmc_cpic_N, as.data.frame(cpic_N_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_N <- df_mcmc_cpic_N %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_N <- centers_cpic_N[1:n_indN, ]

hist(centers_cpic_N) # activity centers for individuals caught at least once

#### Obtaining Density and N

densities_cpic_N <- df_mcmc_cpic_N$density[501:1000] #densities per iteration after burnin
stderror_cpic_N <- std.error(as.vector(densities_cpic_N))
mean_density_cpic_N <- mean(densities_cpic_N) # Mean # turtles per 100 meters

estimated_N_cpic_N <- df_mcmc_cpic_N$N[501:1000]
mean_est_N_cpic_N <- mean(estimated_N_cpic_N) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_N/mean_density_cpic_N


####### Site N, CSER ########

load("Results/JAGS/cser_N_mcmc.RData")

# combine chains
df_mcmc_cser_N <- as.data.frame(cser_N_mcmc[[1]])
for(i in 2:length(cser_N_mcmc)) {
  df_mcmc_cser_N <- bind_rows(df_mcmc_cser_N, as.data.frame(cser_N_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_N <- df_mcmc_cser_N %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_N <- centers_cser_N[1:n_indN, ]

hist(centers_cser_N) # activity centers for individuals caught at least once

#### Obtaining Density and N

densities_cser_N <- df_mcmc_cser_N$density[501:1000] #densities per iteration after burnin
stderror_cser_N <- std.error(as.vector(densities_cser_N))
mean_density_cser_N <- mean(densities_cser_N) # Mean # turtles per 100 meters

estimated_N_cser_N <- df_mcmc_cser_N$N[501:1000]
mean_est_N_cser_N <- mean(estimated_N_cser_N) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_N/mean_density_cser_N


####### Site O, CPIC ########

load("Results/JAGS/cpic_O_mcmc.RData")

# combine chains
df_mcmc_cpic_O <- as.data.frame(cpic_O_mcmc[[1]])
for(i in 2:length(cpic_O_mcmc)) {
  df_mcmc_cpic_O <- bind_rows(df_mcmc_cpic_O, as.data.frame(cpic_O_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cpic_O <- df_mcmc_cpic_O %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cpic_O <- centers_cpic_O[1:n_indO, ]

hist(centers_cpic_O) # activity centers for individuals caught at least once

#### Obtaining Density and N

densities_cpic_O <- df_mcmc_cpic_O$density[501:1000] #densities per iteration after burnin
stderror_cpic_O <- std.error(as.vector(densities_cpic_O))
mean_density_cpic_O <- mean(densities_cpic_O) # Mean # turtles per 100 meters

estimated_N_cpic_O <- df_mcmc_cpic_O$N[501:1000]
mean_est_N_cpic_O <- mean(estimated_N_cpic_O) # Mean # turtles over trap area (+ boundary)
mean_est_N_cpic_O/mean_density_cpic_O


####### Site O, CSER ########

load("Results/JAGS/cser_O_mcmc.RData")

# combine chains
df_mcmc_cser_O <- as.data.frame(cser_O_mcmc[[1]])
for(i in 2:length(cser_O_mcmc)) {
  df_mcmc_cser_O <- bind_rows(df_mcmc_cser_O, as.data.frame(cser_O_mcmc[[i]]))
}

# Obtain Activity Centers
centers_cser_O <- df_mcmc_cser_O %>%
  select(starts_with("s[")) %>%
  summarise_all(mean) %>%
  t()

centers_cser_O <- centers_cser_O[1:n_indO, ]

hist(centers_cser_O) # activity centers for individuals caught at least once


#### Obtaining Density and N

densities_cser_O <- df_mcmc_cser_O$density[501:1000] #densities per iteration after burnin
stderror_cser_O <- std.error(as.vector(densities_cser_O))
mean_density_cser_O <- mean(densities_cser_O) # Mean # turtles per 100 meters

estimated_N_cser_O <- df_mcmc_cser_O$N[501:1000]
mean_est_N_cser_O <- mean(estimated_N_cser_O) # Mean # turtles over trap area (+ boundary)
mean_est_N_cser_O/mean_density_cser_O

```

## Plotting CPIC Activity Centers
Only CPIC activity centers were plotted as CSER densities were very low.
```{r, eval = FALSE}
filepaths <- c("AC_Plots2.pdf","AC_Plots1.pdf")
knitr::include_graphics(filepaths)

##################### Plotting Activity Centers ################
#### See all plots at end!!

par(mfrow=c(3,2))
plot(xy.coords(x = centers_cpic_A[], y = rep(0, 36)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site A")
plot(xy.coords(x = centers_cpic_C[], y = rep(0, 30)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site C")
plot(xy.coords(x = centers_cpic_D[], y = rep(0, 22)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site D")
plot(xy.coords(x = centers_cpic_E[], y = rep(0, 42)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site E")
plot(xy.coords(x = centers_cpic_F[], y = rep(0, 128)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site F")
plot(xy.coords(x = centers_cpic_G[], y = rep(0, 54)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site G")
plot(xy.coords(x = centers_cpic_J[], y = rep(0, 68)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site J")
plot(xy.coords(x = centers_cpic_K[], y = rep(0, 31)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site K")
plot(xy.coords(x = centers_cpic_L[], y = rep(0, 25)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site L")
plot(xy.coords(x = centers_cpic_M[], y = rep(0, 82)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site M")
plot(xy.coords(x = centers_cpic_N[], y = rep(0, 84)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site N")
plot(xy.coords(x = centers_cpic_O[], y = rep(0, 80)), pch = ".", cex = 4, xlab = "Standardized Location in Site", ylab = "", col = "red", main = "CPIC Activity Centers: Site O")

```

```{r}
filepaths <- c("AC_Plots2.pdf","AC_Plots1.pdf")
knitr::include_graphics(filepaths)
```



## Histograms
I then examined the distribution of activity centers at each site for each species by plotting histograms.

```{r, eval = FALSE}

filepaths <- c("AC_Hist1_CPIC.pdf", "AC_Hist_CPIC.pdf", "AC_Hist1_CSER.pdf", "AC_Hist2_CSER.pdf")
knitr::include_graphics(filepaths)

par(mfrow = c(3,2))
hist(centers_cpic_A, main = "CPIC A", xlab = "Activity Centers")
hist(centers_cpic_C, main = "CPIC C", xlab = "Activity Centers")
hist(centers_cpic_D, main = "CPIC D", xlab = "Activity Centers")
hist(centers_cpic_E, main = "CPIC E", xlab = "Activity Centers")
hist(centers_cpic_F, main = "CPIC F", xlab = "Activity Centers")
hist(centers_cpic_G, main = "CPIC G", xlab = "Activity Centers")

hist(centers_cpic_J, main = "CPIC J", xlab = "Activity Centers")
hist(centers_cpic_K, main = "CPIC K", xlab = "Activity Centers")
hist(centers_cpic_L, main = "CPIC L", xlab = "Activity Centers")
hist(centers_cpic_M, main = "CPIC M", xlab = "Activity Centers")
hist(centers_cpic_N, main = "CPIC N", xlab = "Activity Centers")
hist(centers_cpic_O, main = "CPIC O", xlab = "Activity Centers")

########

hist(centers_cser_A, main = "CSER A", xlab = "Activity Centers")
hist(centers_cser_C, main = "CSER C", xlab = "Activity Centers")
hist(centers_cser_E, main = "CSER E", xlab = "Activity Centers")
hist(centers_cser_F, main = "CSER F", xlab = "Activity Centers")
hist(centers_cser_G, main = "CSER G", xlab = "Activity Centers")
hist(centers_cser_J, main = "CSER J", xlab = "Activity Centers")

par(mfrow = c(3,2))
hist(centers_cser_M, main = "CSER M", xlab = "Activity Centers")
hist(centers_cser_N, main = "CSER N", xlab = "Activity Centers")
hist(centers_cser_O, main = "CSER O", xlab = "Activity Centers")

```

```{r}
filepaths <- c("AC_Hist1_CPIC.pdf", "AC_Hist_CPIC.pdf", "AC_Hist1_CSER.pdf", "AC_Hist2_CSER.pdf")
knitr::include_graphics(filepaths)
```

#### I examined whether activity centers per species at each site showed evidence of clustering or segregation. I first had to create a point process along a linear network. If I had examined my resulting point processes as 2D, the second dimension would have changed distances between points and biased dispersion analyses. I first created a linear network using the command *linnet*. I then used the function *as.lpp* to create a point process for each species and site along a line (the canal).

After coering activity centers into lpp objects, I ran monte caro interations of the Linear K function to create a simulation envelope and then compared the observed linear K distribution to the expected distributions.

### EXAMINING DISPERSION: Linear K Function for linear point processes
```{r, eval = FALSE}

## Create Linear Network
# linear network

canal_line <- psp(0, 0, 3, 0, window = owin(xrange = c(0,3), yrange = c(-1,1)))
plot(canal_line)
canal_line <- as.linnet(canal_line)
#### Check validity
plot(canal_line)
text(vertices(canal_line), labels = vertexdegree(canal_line))


##### Creating lpp objects - point process along a linear network #####

ACPIC_X <- list(x=c(centers_cpic_A), y = c(rep(0,36)))
ACPIC_X <- as.lpp(ACPIC_X, L = canal_line)

CCPIC_X <- list(x=c(centers_cpic_C), y = c(rep(0,30)))
CCPIC_X <- as.lpp(CCPIC_X, L = canal_line)

DCPIC_X <- list(x=c(centers_cpic_D), y = c(rep(0,22)))
DCPIC_X <- as.lpp(DCPIC_X, L = canal_line)

ECPIC_X <- list(x=c(centers_cpic_E), y = c(rep(0,42)))
ECPIC_X <- as.lpp(ECPIC_X, L = canal_line)

FCPIC_X <- list(x=c(centers_cpic_F), y = c(rep(0,128)))
FCPIC_X <- as.lpp(FCPIC_X, L = canal_line)

GCPIC_X <- list(x=c(centers_cpic_G), y = c(rep(0,54)))
GCPIC_X <- as.lpp(GCPIC_X, L = canal_line)

JCPIC_X <- list(x=c(centers_cpic_J), y = c(rep(0,68)))
JCPIC_X <- as.lpp(JCPIC_X, L = canal_line)

KCPIC_X <- list(x=c(centers_cpic_K), y = c(rep(0,31)))
KCPIC_X <- as.lpp(KCPIC_X, L = canal_line)

LCPIC_X <- list(x=c(centers_cpic_L), y = c(rep(0,25)))
LCPIC_X <- as.lpp(LCPIC_X, L = canal_line)

MCPIC_X <- list(x=c(centers_cpic_M), y = c(rep(0,82)))
MCPIC_X <- as.lpp(MCPIC_X, L = canal_line)

NCPIC_X <- list(x=c(centers_cpic_N), y = c(rep(0,84)))
NCPIC_X <- as.lpp(NCPIC_X, L = canal_line)

OCPIC_X <- list(x=c(centers_cpic_O), y = c(rep(0,80)))
OCPIC_X <- as.lpp(OCPIC_X, L = canal_line)

########

ACSER_X <- list(x=c(centers_cser_A), y = c(rep(0,5)))
ACSER_X <- as.lpp(ACSER_X, L = canal_line)

CCSER_X <- list(x=c(centers_cser_C), y = c(rep(0,6)))
CCSER_X <- as.lpp(CCSER_X, L = canal_line)

ECSER_X <- list(x=c(centers_cser_E), y = c(rep(0,11)))
ECSER_X <- as.lpp(ECSER_X, L = canal_line)

FCSER_X <- list(x=c(centers_cser_F), y = c(rep(0,8)))
FCSER_X <- as.lpp(FCSER_X, L = canal_line)

GCSER_X <- list(x=c(centers_cser_G), y = c(rep(0,5)))
GCSER_X <- as.lpp(GCSER_X, L = canal_line)

JCSER_X <- list(x=c(centers_cser_J), y = c(rep(0,5)))
JCSER_X <- as.lpp(JCSER_X, L = canal_line)

MCSER_X <- list(x=c(centers_cser_M), y = c(rep(0,8)))
MCSER_X <- as.lpp(MCSER_X, L = canal_line)

NCSER_X <- list(x=c(centers_cser_N), y = c(rep(0,5)))
NCSER_X <- as.lpp(NCSER_X, L = canal_line)

OCSER_X <- list(x=c(centers_cser_O), y = c(rep(0,5)))
OCSER_X <- as.lpp(OCSER_X, L = canal_line)

############ Linear K Monte Carlo Analysis Per Species Per Site ######################

## CPIC, A
linearK_A_CPIC <- linearK(X = ACPIC_X)
summary(linearK_A_CPIC)

linK_A_CPIC <- envelope(ACPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_A_CPIC, main = "Linear K Test on CPIC Site A")

## CPIC, C
linearK_C_CPIC <- linearK(X = CCPIC_X)
summary(linearK_C_CPIC)

linK_C_CPIC <- envelope(CCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_C_CPIC, main = "Linear K Test on CPIC Site C")

## CPIC, D
linearK_D_CPIC <- linearK(X = DCPIC_X)
summary(linearK_D_CPIC)

linK_D_CPIC <- envelope(DCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_D_CPIC, main = "Linear K Test on CPIC Site D")

## CPIC, E
linearK_E_CPIC <- linearK(X = ECPIC_X)
summary(linearK_E_CPIC)

linK_E_CPIC <- envelope(ECPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_E_CPIC, main = "Linear K Test on CPIC Site E")

## CPIC, F
linearK_F_CPIC <- linearK(X = FCPIC_X)
summary(linearK_F_CPIC)

linK_F_CPIC <- envelope(FCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_F_CPIC, main = "Linear K Test on CPIC Site F")

## CPIC, G
linearK_G_CPIC <- linearK(X = GCPIC_X)
summary(linearK_G_CPIC)

linK_G_CPIC <- envelope(GCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_G_CPIC, main = "Linear K Test on CPIC Site G")

## CPIC, J
linearK_J_CPIC <- linearK(X = JCPIC_X)
summary(linearK_J_CPIC)

linK_J_CPIC <- envelope(JCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_J_CPIC, main = "Linear K Test on CPIC Site J")

## CPIC, K
linearK_K_CPIC <- linearK(X = KCPIC_X)
summary(linearK_K_CPIC)

linK_K_CPIC <- envelope(KCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_K_CPIC, main = "Linear K Test on CPIC Site K")

## CPIC, L
linearK_L_CPIC <- linearK(X = LCPIC_X)
summary(linearK_L_CPIC)

linK_L_CPIC <- envelope(LCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_L_CPIC, main = "Linear K Test on CPIC Site L")

## CPIC, M
linearK_M_CPIC <- linearK(X = MCPIC_X)
summary(linearK_M_CPIC)

linK_M_CPIC <- envelope(MCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_M_CPIC, main = "Linear K Test on CPIC Site M")

## CPIC, N
linearK_N_CPIC <- linearK(X = NCPIC_X)
summary(linearK_N_CPIC)

linK_N_CPIC <- envelope(NCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_N_CPIC, main = "Linear K Test on CPIC Site N")

## CPIC, O
linearK_O_CPIC <- linearK(X = OCPIC_X)
summary(linearK_O_CPIC)

linK_O_CPIC <- envelope(OCPIC_X, linearK, nsim = 99, nrank = 1)
plot(linK_O_CPIC, main = "Linear K Test on CPIC Site O")

## CSER, A
linearK_A_CSER <- linearK(X = ACSER_X)
summary(linearK_A_CSER)

linK_A_CSER <- envelope(ACSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_A_CSER, main = "Linear K Test on CSER Site A")

## CSER, C
linearK_C_CSER <- linearK(X = CCSER_X)
summary(linearK_C_CSER)

linK_C_CSER <- envelope(CCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_C_CSER, main = "Linear K Test on CSER Site C")

## CSER, E
linearK_E_CSER <- linearK(X = ECSER_X)
summary(linearK_E_CSER)

linK_E_CSER <- envelope(ECSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_E_CSER, main = "Linear K Test on CSER Site E")

## CSER, F
linearK_F_CSER <- linearK(X = FCSER_X)
summary(linearK_F_CSER)

linK_F_CSER <- envelope(FCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_F_CSER, main = "Linear K Test on CSER Site F")

## CSER, G
linearK_G_CSER <- linearK(X = GCSER_X)
summary(linearK_G_CSER)

linK_G_CSER <- envelope(GCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_G_CSER, main = "Linear K Test on CSER Site G")

## CSER, J
linearK_J_CSER <- linearK(X = JCSER_X)
summary(linearK_J_CSER)

linK_J_CSER <- envelope(JCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_J_CSER, main = "Linear K Test on CSER Site J")

## CSER, M
linearK_M_CSER <- linearK(X = MCSER_X)
summary(linearK_M_CSER)

linK_M_CSER <- envelope(MCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_M_CSER, main = "Linear K Test on CSER Site M")

## CSER, N
linearK_N_CSER <- linearK(X = NCSER_X)
summary(linearK_N_CSER)

linK_N_CSER <- envelope(NCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_N_CSER, main = "Linear K Test on CSER Site N")

## CSER, O
linearK_O_CSER <- linearK(X = OCSER_X)
summary(linearK_O_CSER)

linK_O_CSER <- envelope(OCSER_X, linearK, nsim = 99, nrank = 1)
plot(linK_O_CSER, main = "Linear K Test on CSER Site O")


```

## Plotting Linear K Simulations with Envelopes
```{r, eval = FALSE}
filepaths <- c("AC_LinK1_CPIC.pdf", "AC_LinK2_CPIC.pdf", "AC_LinK3_CPIC.pdf", "AC_LinK1_CSER.pdf", "AC_LinK2_CSER.pdf", "AC_LinK3_CSER.pdf")
knitr::include_graphics(filepaths)


par(mfrow = c(2,2))
plot(linK_A_CPIC, main = "CPIC A", legend = "")
plot(linK_C_CPIC, main = "CPIC C", legend = "")
plot(linK_D_CPIC, main = "CPIC D", legend = "")
plot(linK_E_CPIC, main = "CPIC E", legend = "")

plot(linK_F_CPIC, main = "CPIC F", legend = "")
plot(linK_G_CPIC, main = "CPIC G", legend = "")
plot(linK_J_CPIC, main = "CPIC J", legend = "")
plot(linK_K_CPIC, main = "CPIC K", legend = "")

plot(linK_L_CPIC, main = "CPIC L", legend = "")
plot(linK_M_CPIC, main = "CPIC M", legend = "")
plot(linK_N_CPIC, main = "CPIC N", legend = "")
plot(linK_O_CPIC, main = "CPIC O", legend = "")

########

plot(linK_A_CSER, main = "CSER A", legend = "")
plot(linK_C_CSER, main = "CSER C", legend = "")
plot(linK_E_CSER, main = "CSER E", legend = "")
plot(linK_F_CSER, main = "CSER F", legend = "")

plot(linK_G_CSER, main = "CSER G", legend = "")
plot(linK_J_CSER, main = "CSER J", legend = "")
plot(linK_M_CSER, main = "CSER M", legend = "")
plot(linK_N_CSER, main = "CSER N", legend = "")

plot(linK_O_CSER, main = "CSER O", legend = "")

```

Dispersion analysis on activity centers for most CPIC and site combinations provided evidence of small amounts of clustering. Sites A, E, F, and J seemed to have the most clustered CPIC activity centers, sites L, N, and O had less clustered activity centers, and sites C, D, G, K, and M seemed to have the random CPIC activity centers.

Due to low sample size of CSER at all sites, dispersion analysis was unable to detect a significant difference from a random point process. Sites F, N, and O did seem to have very slight clustering in activity centers at very brief r windows.

```{r}
filepaths <- c("AC_LinK1_CPIC.pdf", "AC_LinK2_CPIC.pdf", "AC_LinK3_CPIC.pdf", "AC_LinK1_CSER.pdf", "AC_LinK2_CSER.pdf", "AC_LinK3_CSER.pdf")
knitr::include_graphics(filepaths)
```


## Graphing Density By Site
```{r, eval = FALSE}
filepaths <- c("CPIC_Plot.pdf", "CSER_Plot.pdf")
knitr::include_graphics(filepaths)

###############  Graphing Density By Site ################

x <- c("A","C","D","E","F","G","J","K","L","M","N","O")
density_list <- c(mean_density_cpic_A, mean_density_cpic_C, mean_density_cpic_D, mean_density_cpic_E, mean_density_cpic_F, mean_density_cpic_G, mean_density_cpic_J, mean_density_cpic_K, mean_density_cpic_L, mean_density_cpic_M, mean_density_cpic_N, mean_density_cpic_O)
stderror_list_cpic <- c(stderror_cpic_A, stderror_cpic_C, stderror_cpic_D, stderror_cpic_E, stderror_cpic_F, stderror_cpic_G, stderror_cpic_J, stderror_cpic_K, stderror_cpic_L, stderror_cpic_M, stderror_cpic_N, stderror_cpic_O)

# barplot(density_list, names.arg = c("A","C","D","E","F","G","J","K","L","M","N","O"), main = "CPIC Density by Site", col = "brown", xlab = "Site", ylab = "Density")

cbind_cpic <- cbind(data.frame(site = x, density = density_list, stderror = stderror_list_cpic))

p <- ggplot(cbind_cpic, aes(x=site, y=density)) + 
  geom_bar(stat="identity", color="darkorange3", fill = "darkorange3", 
           position=position_dodge()) +
  geom_errorbar(aes(ymin=density-stderror, ymax=density+stderror), width=.2,
                 position=position_dodge(.9)) 
print(p)

p + labs(x="Site", y = "Density (Individuals Per 100m)")+
   theme_classic() +
   scale_fill_manual(values=c('#999999','#E69F00')) +
  ggtitle("CPIC Site Densities") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.title.x = element_text(size=14),
        axis.title.y = element_text(size=14)
)

x <- c("A","C","E","F","G","J","M","N","O")
density_list_cser <- c(mean_density_cser_A, mean_density_cser_C, mean_density_cser_E, mean_density_cser_F, mean_density_cser_G, mean_density_cser_J, mean_density_cser_M, mean_density_cser_N, mean_density_cser_O)
stderror_list_cser <- c(stderror_cser_A, stderror_cser_C, stderror_cser_E, stderror_cser_F, stderror_cser_G, stderror_cser_J, stderror_cser_M, stderror_cser_N, stderror_cser_O)

# barplot(density_list_cser, names.arg = c("A","C","E","F","G","J","M","N","O"), main = "CSER Density by Site", col = "brown", xlab = "Site", ylab = "Density")

cbind_cser <- cbind(data.frame(site = x, density = density_list_cser, stderror = stderror_list_cser))

p <- ggplot(cbind_cser, aes(x=site, y=density)) + 
  geom_bar(stat="identity", color="darkorange3", fill = "darkorange3", 
           position=position_dodge()) +
  geom_errorbar(aes(ymin=density-stderror, ymax=density+stderror), width=.2,
                 position=position_dodge(.9)) 
print(p)

p + labs(x="Site", y = "Density (Individuals Per 100m)")+
   theme_classic() +
   scale_fill_manual(values=c('#999999','#E69F00')) +
  ggtitle("Snapping Turtle Site Densities") +
  theme(plot.title = element_text(hjust = 0.5, size = 16),
        axis.title.x = element_text(size=14),
        axis.title.y = element_text(size=14)
)

```


```{r}
filepaths <- c("CPIC_Plot.pdf", "CSER_Plot.pdf")
knitr::include_graphics(filepaths)
```

I also created 2 GIS maps illustrating site locations in relation to potential land use characteristics (nearby land use types that might greatly impact turtle densities: development, cultivated crops, pasture, wetland vegetation). Future directions for this project could include interpolating turtle densities between sites using species distribution modeling OR calculating distance to land use type and examining whether distances impact densities or dispersal between sites. 
